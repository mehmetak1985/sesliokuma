<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sesli Okuma Oyunu</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  "use strict";
  :root {
    --bg: #0f1b2d;
    --surface: #1a2d46;
    --surface2: #223558;
    --accent: #ffd166;
    --accent2: #06d6a0;
    --red: #ef476f;
    --green: #06d6a0;
    --yellow: #ffd166;
    --blue: #118ab2;
    --text: #e8f4fd;
    --text-muted: #7fa8c9;
    --radius: 20px;
    --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Baloo 2', cursive;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .stars {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }
  .star {
    position: absolute;
    border-radius: 50%;
    background: white;
    animation: twinkle var(--d, 3s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);
    opacity: 0.3;
  }
  @keyframes twinkle {
    0%, 100% { opacity: 0.1; transform: scale(0.8); }
    50% { opacity: 0.7; transform: scale(1.2); }
  }

  .game-container {
    position: relative;
    z-index: 1;
    width: min(90vw, 640px);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
  }

  .title-area { text-align: center; }
  .title-area h1 {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(1.8rem, 6vw, 3rem);
    color: var(--accent);
    text-shadow: 0 0 20px rgba(255,209,102,0.4), 0 4px 8px rgba(0,0,0,0.5);
    letter-spacing: -0.5px;
  }
  .subtitle { font-size: 0.95rem; color: var(--text-muted); margin-top: 4px; }

  .score-card {
    background: var(--surface);
    border: 2px solid var(--surface2);
    border-radius: var(--radius);
    padding: 12px 32px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: var(--shadow);
  }
  .score-icon { font-size: 1.6rem; }
  .score-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
  .score-value {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 2rem;
    color: var(--accent);
    line-height: 1;
  }
  .score-value.bump { animation: scoreBump 0.3s ease; }
  @keyframes scoreBump {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); color: #fff; }
    100% { transform: scale(1); }
  }

  .word-card {
    background: var(--surface);
    border: 2px solid var(--surface2);
    border-radius: var(--radius);
    padding: 36px 40px;
    width: 100%;
    box-shadow: var(--shadow);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    min-height: 120px;
  }

  .word {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(2rem, 8vw, 3.5rem);
    padding: 8px 18px;
    border-radius: 14px;
    border: 3px solid transparent;
    transition: all 0.25s ease;
    cursor: default;
    color: var(--text);
  }

  .word.active {
    background: rgba(255, 209, 102, 0.15);
    border-color: var(--yellow);
    color: var(--yellow);
    transform: scale(1.08);
    animation: pulse 1.2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 20px rgba(255,209,102,0.3); }
    50% { box-shadow: 0 0 36px rgba(255,209,102,0.6); }
  }

  .word.correct {
    background: rgba(6, 214, 160, 0.15);
    border-color: var(--green);
    color: var(--green);
    animation: correctPop 0.4s ease forwards;
  }
  @keyframes correctPop {
    0% { transform: scale(1); }
    40% { transform: scale(1.15) rotate(-2deg); }
    70% { transform: scale(0.97) rotate(1deg); }
    100% { transform: scale(1) rotate(0deg); }
  }

  .word.wrong {
    background: rgba(239, 71, 111, 0.15);
    border-color: var(--red);
    color: var(--red);
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .mic-area { display: flex; flex-direction: column; align-items: center; gap: 10px; }
  .mic-indicator {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--surface);
    border: 3px solid var(--surface2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    transition: all 0.3s ease;
  }
  .mic-indicator.active {
    background: rgba(239, 71, 111, 0.15);
    border-color: var(--red);
    animation: micPulse 1s ease-in-out infinite;
  }
  @keyframes micPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(239, 71, 111, 0.4); }
    50% { box-shadow: 0 0 0 16px rgba(239, 71, 111, 0); }
  }
  .mic-status { font-size: 0.85rem; color: var(--text-muted); text-align: center; min-height: 20px; }
  .mic-status.listening { color: var(--red); }

  .interim-text { font-size: 0.9rem; color: var(--text-muted); font-style: italic; min-height: 22px; text-align: center; }

  .button-row { display: flex; gap: 16px; }
  .btn {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 1.1rem;
    padding: 14px 36px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 14px rgba(0,0,0,0.3);
  }
  .btn:active { transform: scale(0.96); }
  .btn-start { background: linear-gradient(135deg, var(--green), #04b88a); color: #0a2a1f; }
  .btn-stop { background: linear-gradient(135deg, var(--red), #d63060); color: #000; }
  .btn:disabled { opacity: 0.35; cursor: not-allowed; }

  .congrats-banner {
    display: none;
    background: linear-gradient(135deg, #ffd166, #ff9f1c);
    color: #1a0a00;
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(1.4rem, 5vw, 2rem);
    padding: 18px 40px;
    border-radius: var(--radius);
    text-align: center;
    width: 100%;
    animation: congratsIn 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  .congrats-banner.visible { display: block; }
  @keyframes congratsIn {
    0% { transform: scale(0.5) opacity: 0; }
    100% { transform: scale(1) opacity: 1; }
  }

  .error-msg {
    display: none;
    color: var(--red);
    font-size: 0.9rem;
    text-align: center;
    background: rgba(239,71,111,0.1);
    padding: 10px;
    border-radius: 12px;
    width: 100%;
  }
  .error-msg.visible { display: block; }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="game-container">
  <div class="title-area">
    <h1>üåü Sesli Okuma Oyunu</h1>
    <p class="subtitle">Kelimeyi sesli oku ve puan kazan!</p>
  </div>

  <div class="score-card">
    <span class="score-icon">‚≠ê</span>
    <div>
      <div class="score-label">Puan</div>
      <div class="score-value" id="scoreDisplay">0</div>
    </div>
  </div>

  <div class="word-card" id="wordCard"></div>

  <div class="mic-area">
    <div class="mic-indicator" id="micIndicator">üé§</div>
    <div class="mic-status" id="micStatus">Ba≈ülamak i√ßin d√ºƒümeye bas</div>
  </div>

  <div class="interim-text" id="interimText"></div>

  <div class="button-row">
    <button class="btn btn-start" id="btnStart">‚ñ∂ Ba≈üla</button>
    <button class="btn btn-stop" id="btnStop" disabled>üîÑ Tekrar</button>
  </div>

  <div class="congrats-banner" id="congratsBanner">üéâ Tebrikler! Harika okudun! üéâ</div>
  <div class="error-msg" id="errorMsg"></div>
</div>

<script>
"use strict";

// --- DOM √ñnbelleƒüe Alma (Performans i√ßin) ---
const elements = {
  stars: document.getElementById('stars'),
  btnStart: document.getElementById('btnStart'),
  btnStop: document.getElementById('btnStop'),
  wordCard: document.getElementById('wordCard'),
  scoreDisplay: document.getElementById('scoreDisplay'),
  micIndicator: document.getElementById('micIndicator'),
  micStatus: document.getElementById('micStatus'),
  interimText: document.getElementById('interimText'),
  congratsBanner: document.getElementById('congratsBanner'),
  errorMsg: document.getElementById('errorMsg')
};

// --- Arka Plan Yƒ±ldƒ±zlarƒ± ---
(function yaratYildizlar() {
  const fragment = document.createDocumentFragment();
  for (let i = 0; i < 60; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const boyut = Math.random() * 3 + 1;
    s.style.cssText = `width:${boyut}px; height:${boyut}px; left:${Math.random()*100}%; top:${Math.random()*100}%; --d:${2 + Math.random()*4}s; --delay:${Math.random()*5}s;`;
    fragment.appendChild(s);
  }
  elements.stars.appendChild(fragment);
})();

// --- Oyun Deƒüi≈ükenleri ---
const HEDEF_METIN = "Ali topu at";
let targetWords = [];
let wordSpans = [];
let currentWordIndex = 0;
let score = 0;
let isListening = false;
let recognition = null;
let helperTimer = null;

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

// --- Normalizasyon ---
function normalizeText(metin) {
  if (!metin) return [];
  return metin.replace(/I/g, 'ƒ±').replace(/ƒ∞/g, 'i').toLocaleLowerCase('tr-TR')
              .replace(/[^\p{L}\s]/gu, '').trim().split(/\s+/).filter(t => t.length > 0);
}

// --- Oyunu Kur ---
function oyunuKur() {
  targetWords = normalizeText(HEDEF_METIN);
  elements.wordCard.innerHTML = '';
  wordSpans = [];

  const orijinalKelimeler = HEDEF_METIN.split(/\s+/);
  targetWords.forEach((_, i) => {
    const span = document.createElement('span');
    span.className = 'word' + (i === 0 ? ' active' : '');
    span.textContent = orijinalKelimeler[i];
    elements.wordCard.appendChild(span);
    wordSpans.push(span);
  });
}

// --- Yardƒ±mcƒ± Seslendirme ---
function yardimliSeslendir(kelime) {
  const utterance = new SpeechSynthesisUtterance(kelime);
  utterance.lang = 'tr-TR';
  utterance.rate = 0.8;
  window.speechSynthesis.speak(utterance);
}

// --- Kelime Doƒürulama (Hƒ±zlƒ± Tepki Modu) ---
function validateWord(gelenMetin) {
  if (currentWordIndex >= targetWords.length) return;

  const kelimeler = normalizeText(gelenMetin);
  const hedef = targetWords[currentWordIndex];
  
  // Konu≈üulan her bir kelimeyi kontrol et
  if (kelimeler.some(k => k === hedef)) {
    clearTimeout(helperTimer); // Doƒüru bildiƒüi i√ßin sayacƒ± sƒ±fƒ±rla
    
    const span = wordSpans[currentWordIndex];
    span.className = 'word correct';
    
    score += 10;
    currentWordIndex++;

    requestAnimationFrame(() => {
      elements.scoreDisplay.textContent = score;
      elements.scoreDisplay.classList.add('bump');
      setTimeout(() => elements.scoreDisplay.classList.remove('bump'), 300);
      
      if (currentWordIndex < targetWords.length) {
        wordSpans[currentWordIndex].className = 'word active';
        startHelperTimer(); // Yeni kelime i√ßin zamanlayƒ±cƒ±yƒ± ba≈ülat
      } else {
        endGame();
      }
    });
    return true;
  }
  return false;
}

// --- Yardƒ±mcƒ± Zamanlayƒ±cƒ± ---
function startHelperTimer() {
  clearTimeout(helperTimer);
  helperTimer = setTimeout(() => {
    if (isListening && currentWordIndex < targetWords.length) {
      yardimliSeslendir(targetWords[currentWordIndex]);
      startHelperTimer(); // Tekrarla
    }
  }, 4000); // 4 saniye sessiz kalƒ±rsa yardƒ±m et
}

// --- Ses Tanƒ±ma Ayarlarƒ± ---
function initRecognition() {
  recognition = new SpeechRecognition();
  recognition.lang = 'tr-TR';
  recognition.continuous = true;
  recognition.interimResults = true; // Anlƒ±k takip a√ßƒ±k
  recognition.maxAlternatives = 3;   // Benzer kelimeleri s√ºz

  recognition.onresult = (event) => {
    let interim = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const transcript = event.results[i][0].transcript;
      if (event.results[i].isFinal) {
        validateWord(transcript);
      } else {
        interim += transcript;
        // Interim (ara sonu√ß) i√ßindeyken de hƒ±zlƒ±ca kontrol et
        if(validateWord(transcript)) break; 
      }
    }
    elements.interimText.textContent = interim;
  };

  recognition.onerror = (e) => {
    if (e.error === 'no-speech') return;
    elements.errorMsg.textContent = "Hata: " + e.error;
    elements.errorMsg.classList.add('visible');
  };

  recognition.onend = () => {
    if (isListening) recognition.start();
  };
}

// --- Oyun Kontrolleri ---
function endGame() {
  isListening = false;
  recognition.stop();
  clearTimeout(helperTimer);
  elements.congratsBanner.classList.add('visible');
  elements.micStatus.textContent = "üéâ Harika okudun!";
  elements.btnStart.disabled = false;
  elements.btnStop.disabled = true;
  elements.micIndicator.classList.remove('active');
}

elements.btnStart.addEventListener('click', () => {
  if (!SpeechRecognition) return;
  
  oyunuKur();
  initRecognition();
  
  currentWordIndex = 0;
  score = 0;
  isListening = true;
  
  elements.scoreDisplay.textContent = '0';
  elements.congratsBanner.classList.remove('visible');
  elements.errorMsg.classList.remove('visible');
  elements.btnStart.disabled = true;
  elements.btnStop.disabled = false;
  elements.micIndicator.classList.add('active');
  elements.micStatus.textContent = "üé§ Dinliyorum...";

  recognition.start();
  startHelperTimer();
});

elements.btnStop.addEventListener('click', () => {
  location.reload();
});

oyunuKur();
</script>
</body>
</html>
