<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sesli Okuma Oyunu</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1b2d;
    --surface: #1a2d46;
    --surface2: #223558;
    --accent: #ffd166;
    --accent2: #06d6a0;
    --red: #ef476f;
    --green: #06d6a0;
    --yellow: #ffd166;
    --blue: #118ab2;
    --text: #e8f4fd;
    --text-muted: #7fa8c9;
    --radius: 20px;
    --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Baloo 2', cursive;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .stars {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }
  .star {
    position: absolute;
    border-radius: 50%;
    background: white;
    animation: twinkle var(--d, 3s) ease-in-out infinite;
    animation-delay: var(--delay, 0s);
    opacity: 0.3;
  }
  @keyframes twinkle {
    0%, 100% { opacity: 0.1; transform: scale(0.8); }
    50% { opacity: 0.7; transform: scale(1.2); }
  }

  .game-container {
    position: relative;
    z-index: 1;
    width: min(90vw, 700px);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  .title-area { text-align: center; }
  .title-area h1 {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(1.6rem, 5vw, 2.6rem);
    color: var(--accent);
    text-shadow: 0 0 20px rgba(255,209,102,0.4), 0 4px 8px rgba(0,0,0,0.5);
    letter-spacing: -0.5px;
  }
  .subtitle {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .sentence-badge {
    font-size: 0.8rem;
    color: var(--text-muted);
    background: var(--surface2);
    padding: 4px 14px;
    border-radius: 20px;
    margin-top: 6px;
    display: inline-block;
  }

  .score-card {
    background: var(--surface);
    border: 2px solid var(--surface2);
    border-radius: var(--radius);
    padding: 12px 32px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: var(--shadow);
  }
  .score-icon { font-size: 1.6rem; }
  .score-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .score-value {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 2rem;
    color: var(--accent);
    line-height: 1;
    transition: transform 0.15s ease;
  }
  .score-value.bump { animation: scoreBump 0.3s ease; }
  @keyframes scoreBump {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); color: #fff; }
    100% { transform: scale(1); }
  }

  .word-card {
    background: var(--surface);
    border: 2px solid var(--surface2);
    border-radius: var(--radius);
    padding: 28px 32px;
    width: 100%;
    box-shadow: var(--shadow);
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    min-height: 110px;
  }

  .word {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(1.6rem, 6vw, 3rem);
    padding: 6px 14px;
    border-radius: 12px;
    border: 3px solid transparent;
    transition: all 0.25s ease;
    cursor: default;
    letter-spacing: 0.5px;
    color: var(--text);
    background: transparent;
  }
  .word.active {
    background: rgba(255, 209, 102, 0.15);
    border-color: var(--yellow);
    color: var(--yellow);
    transform: scale(1.08);
    box-shadow: 0 0 20px rgba(255,209,102,0.3);
    animation: pulse 1.2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 20px rgba(255,209,102,0.3); }
    50% { box-shadow: 0 0 36px rgba(255,209,102,0.6); }
  }
  .word.correct {
    background: rgba(6, 214, 160, 0.15);
    border-color: var(--green);
    color: var(--green);
    animation: correctPop 0.4s ease forwards;
  }
  @keyframes correctPop {
    0% { transform: scale(1); }
    40% { transform: scale(1.15) rotate(-2deg); }
    70% { transform: scale(0.97) rotate(1deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  .word.wrong {
    background: rgba(239, 71, 111, 0.15);
    border-color: var(--red);
    color: var(--red);
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .mic-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }
  .mic-indicator {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: var(--surface);
    border: 3px solid var(--surface2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    transition: all 0.3s ease;
    box-shadow: var(--shadow);
  }
  .mic-indicator.active {
    background: rgba(239, 71, 111, 0.15);
    border-color: var(--red);
    animation: micPulse 1s ease-in-out infinite;
  }
  @keyframes micPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(239, 71, 111, 0.4); }
    50% { box-shadow: 0 0 0 14px rgba(239, 71, 111, 0); }
  }
  .mic-status {
    font-size: 0.85rem;
    color: var(--text-muted);
    text-align: center;
    min-height: 20px;
    transition: color 0.3s;
  }
  .mic-status.listening { color: var(--red); }

  .interim-text {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-style: italic;
    min-height: 20px;
    text-align: center;
    max-width: 500px;
    transition: opacity 0.2s;
  }

  .button-row { display: flex; gap: 16px; }
  .btn {
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: 1.05rem;
    padding: 13px 32px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 14px rgba(0,0,0,0.3);
    letter-spacing: 0.5px;
  }
  .btn:active { transform: scale(0.96); }
  .btn-start {
    background: linear-gradient(135deg, var(--green), #04b88a);
    color: #0a2a1f;
  }
  .btn-start:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(6,214,160,0.4);
  }
  .btn-stop {
    background: linear-gradient(135deg, var(--red), #d63060);
    color: #fff;
  }
  .btn-stop:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(239,71,111,0.4);
  }
  .btn:disabled {
    opacity: 0.35;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none;
  }

  .congrats-banner {
    display: none;
    background: linear-gradient(135deg, #ffd166, #ff9f1c);
    color: #1a0a00;
    font-family: 'Nunito', sans-serif;
    font-weight: 900;
    font-size: clamp(1.2rem, 4vw, 1.8rem);
    padding: 16px 32px;
    border-radius: var(--radius);
    text-align: center;
    width: 100%;
    box-shadow: 0 8px 32px rgba(255,209,102,0.5);
  }
  .congrats-banner.visible {
    display: block;
    animation: congratsIn 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards;
  }
  @keyframes congratsIn {
    0% { transform: scale(0.5) rotate(-4deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  .error-msg {
    display: none;
    color: var(--red);
    font-size: 0.9rem;
    text-align: center;
    background: rgba(239,71,111,0.1);
    border: 1px solid rgba(239,71,111,0.3);
    border-radius: 12px;
    padding: 10px 20px;
    width: 100%;
  }
  .error-msg.visible { display: block; }

  .no-support {
    display: none;
    color: var(--accent);
    text-align: center;
    font-size: 1.1rem;
    padding: 20px;
  }
  .no-support.visible { display: block; }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="game-container" id="gameContainer">

  <div class="title-area">
    <h1>ğŸŒŸ Sesli Okuma Oyunu</h1>
    <p class="subtitle">Kelimeyi sesli oku ve puan kazan!</p>
    <span class="sentence-badge" id="sentenceBadge">CÃ¼mle 1 / 6</span>
  </div>

  <div class="score-card">
    <span class="score-icon">â­</span>
    <div>
      <div class="score-label">Puan</div>
      <div class="score-value" id="scoreDisplay">0</div>
    </div>
  </div>

  <div class="word-card" id="wordCard"></div>

  <div class="mic-area">
    <div class="mic-indicator" id="micIndicator">ğŸ¤</div>
    <div class="mic-status" id="micStatus">BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas</div>
  </div>

  <div class="interim-text" id="interimText"></div>

  <div class="button-row">
    <button class="btn btn-start" id="btnStart">â–¶ BaÅŸla</button>
    <button class="btn btn-stop" id="btnStop" disabled>ğŸ”„ Tekrar</button>
  </div>

  <div class="congrats-banner" id="congratsBanner"></div>

  <div class="error-msg" id="errorMsg"></div>

  <div class="no-support" id="noSupport">
    ğŸ˜” ÃœzgÃ¼nÃ¼m, tarayÄ±cÄ±n sesli tanÄ±ma Ã¶zelliÄŸini desteklemiyor. LÃ¼tfen Google Chrome kullan.
  </div>

</div>

<script>
"use strict";

// â”€â”€â”€ YÄ±ldÄ±z arka planÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function yaratYildizlar() {
  const starsEl = document.getElementById('stars');
  const fragment = document.createDocumentFragment();
  for (let i = 0; i < 80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const boyut = Math.random() * 3 + 1;
    s.style.cssText = `
      width:${boyut}px; height:${boyut}px;
      left:${Math.random()*100}%;
      top:${Math.random()*100}%;
      --d:${2 + Math.random()*4}s;
      --delay:${Math.random()*5}s;
    `;
    fragment.appendChild(s);
  }
  starsEl.appendChild(fragment);
})();

// â”€â”€â”€ TarayÄ±cÄ± desteÄŸi kontrolÃ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  document.getElementById('noSupport').classList.add('visible');
  document.getElementById('btnStart').disabled = true;
}

// â”€â”€â”€ CÃœMLE LÄ°STESÄ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CUMLELER = [
  "Ali",
  "IlÄ±k sÃ¼t",
  "Baba eve gel",
  "Annem bana elma aldÄ±",
  "Kedi sÃ¼tÃ¼nÃ¼ iÃ§ip uykuya daldÄ±",
  "Ali topu at",
];

let currentSentenceIndex = 0;

// â”€â”€â”€ Durum deÄŸiÅŸkenleri â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/** @type {string[]} */
let targetWords = [];

/** @type {HTMLSpanElement[]} */
let wordSpans = [];

let currentWordIndex = 0;
let score = 0;
let isListening = false;

/** @type {InstanceType<typeof SpeechRecognition>|null} */
let recognition = null;

let restartDebounceTimer = null;
let lastError = null;
let interimKabulEdildi = false;

// Oyun bitti mi flag â€” Ã§ift endGame tetiklenmesini engeller
let oyunBitti = false;

// â”€â”€â”€ DOM referanslarÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const btnStart       = document.getElementById('btnStart');
const btnStop        = document.getElementById('btnStop');
const wordCard       = document.getElementById('wordCard');
const scoreDisplay   = document.getElementById('scoreDisplay');
const micIndicator   = document.getElementById('micIndicator');
const micStatus      = document.getElementById('micStatus');
const interimText    = document.getElementById('interimText');
const congratsBanner = document.getElementById('congratsBanner');
const errorMsg       = document.getElementById('errorMsg');
const sentenceBadge  = document.getElementById('sentenceBadge');

// â”€â”€â”€ TTS: DoÄŸru kelimeyi seslendir â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// YanlÄ±ÅŸ okuma veya hece yutmasÄ± durumunda hedef kelimeyi tarayÄ±cÄ± sesiyle okur.
// Mikrofonu TTS sÄ±rasÄ±nda durdurur, bittikten sonra yeniden baÅŸlatÄ±r.
function hedefiSeslendir(metin) {
  try {
    if (!window.speechSynthesis) return;

    // Ã–nce sÄ±rayÄ± temizle
    window.speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(metin);
    utterance.lang = 'tr-TR';
    utterance.rate = 0.85;   // biraz yavaÅŸ â€” Ã¶ÄŸrenci iÃ§in net telaffuz
    utterance.pitch = 1.0;
    utterance.volume = 1.0;

    // TÃ¼rkÃ§e ses varsa kullan
    const sesler = window.speechSynthesis.getVoices();
    const trSes = sesler.find(v => v.lang === 'tr-TR' || v.lang.startsWith('tr'));
    if (trSes) utterance.voice = trSes;

    // TTS konuÅŸurken mikrofonu durdur, bitince yeniden baÅŸlat
    utterance.onstart = () => {
      if (recognition) {
        try { recognition.abort(); } catch(e) {}
        recognition = null;
      }
    };

    utterance.onend = () => {
      // TTS bittikten sonra dinlemeye devam et (oyun hÃ¢lÃ¢ aktifse)
      if (isListening && !oyunBitti && currentWordIndex < targetWords.length) {
        setTimeout(() => startRecognition(), 300);
      }
    };

    window.speechSynthesis.speak(utterance);
  } catch(e) {
    // TTS desteklenmiyorsa sessizce devam et
  }
}

// â”€â”€â”€ Oyunu kur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function oyunuKur() {
  const idx = currentSentenceIndex % CUMLELER.length;
  const aktifCumle = CUMLELER[idx];

  sentenceBadge.textContent = `CÃ¼mle ${idx + 1} / ${CUMLELER.length}`;

  const orijinalKelimeler = aktifCumle.split(/\s+/);
  targetWords = normalizeText(aktifCumle);
  wordSpans = [];
  interimKabulEdildi = false;
  oyunBitti = false;

  const fragment = document.createDocumentFragment();
  targetWords.forEach((kelime, i) => {
    const span = document.createElement('span');
    span.className = 'word' + (i === 0 ? ' active' : '');
    span.textContent = orijinalKelimeler[i] || kelime;
    span.dataset.index = i;
    fragment.appendChild(span);
    wordSpans.push(span);
  });

  wordCard.innerHTML = '';
  wordCard.appendChild(fragment);
}

// â”€â”€â”€ TÃ¼rkÃ§e normalizasyon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/**
 * @param {string} metin
 * @returns {string[]}
 */
function normalizeText(metin) {
  if (!metin || typeof metin !== 'string') return [];
  let sonuc = metin
    .replace(/I/g, 'Ä±')
    .replace(/Ä°/g, 'i')
    .toLocaleLowerCase('tr-TR');
  sonuc = sonuc.replace(/[^\p{L}\s]/gu, '');
  return sonuc.split(/\s+/).filter(t => t.length > 0);
}

// â”€â”€â”€ Kelime eÅŸleÅŸme kontrolÃ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/**
 * @param {string} konusulan
 * @param {string} hedef
 * @returns {boolean}
 */
function kelimeEslesiyor(konusulan, hedef) {
  if (!konusulan || !hedef) return false;
  if (konusulan === hedef) return true;

  const minLen = Math.min(konusulan.length, hedef.length);
  if (minLen <= 2) return konusulan === hedef;

  if (konusulan.startsWith(hedef) && hedef.length >= 3) return true;
  if (hedef.startsWith(konusulan) && konusulan.length >= 3) return true;

  return false;
}

// â”€â”€â”€ Transcript iÃ§inde hedef kelimeyi ara â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/**
 * @param {string[]} kelimeler
 * @returns {boolean}
 */
function transcriptIsleBul(kelimeler) {
  if (currentWordIndex >= targetWords.length) return false;
  const hedef = targetWords[currentWordIndex];
  for (const kelime of kelimeler) {
    if (kelimeEslesiyor(kelime, hedef)) return true;
  }
  return false;
}

// â”€â”€â”€ Kelime doÄŸrulama â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/**
 * @param {boolean} dogru
 */
function validateWord(dogru) {
  if (oyunBitti) return;
  if (currentWordIndex >= targetWords.length) return;

  const span = wordSpans[currentWordIndex];

  if (dogru) {
    span.className = 'word correct';
    score += 10;
    currentWordIndex++;
    interimKabulEdildi = false;

    const gameOver = currentWordIndex === targetWords.length;
    requestAnimationFrame(() => { updateUI(); });

    if (gameOver) endGame();

  } else {
    // â”€ YanlÄ±ÅŸ: span'Ä± kÄ±rmÄ±zÄ± yap, hedef kelimeyi seslendir
    const hedefKelime = targetWords[currentWordIndex];
    const orijinalKelime = wordSpans[currentWordIndex].textContent;

    span.className = 'word wrong';

    // Hedef kelimeyi sesli sÃ¶yle
    hedefiSeslendir(orijinalKelime || hedefKelime);

    // 800ms sonra active'e geri dÃ¶n (TTS iÃ§in biraz daha uzun sÃ¼re)
    setTimeout(() => {
      if (!oyunBitti && currentWordIndex < targetWords.length) {
        span.className = 'word active';
      }
    }, 800);
  }
}

// â”€â”€â”€ UI gÃ¼ncelle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateUI() {
  if (currentWordIndex < wordSpans.length) {
    const span = wordSpans[currentWordIndex];
    if (!span.classList.contains('correct') && !span.classList.contains('wrong')) {
      span.className = 'word active';
    }
  }

  scoreDisplay.textContent = score;
  scoreDisplay.classList.remove('bump');
  void scoreDisplay.offsetWidth;
  scoreDisplay.classList.add('bump');
}

// â”€â”€â”€ Oyun sonu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FIX: oyunBitti flag'i ile Ã§ift tetikleme engellendi.
// FIX: btnStart/btnStop disabled durumlarÄ± ve setTimeout zinciri sadeleÅŸtirildi.
function endGame() {
  if (oyunBitti) return;
  oyunBitti = true;

  stopRecognition();

  wordSpans.forEach((span) => {
    if (!span.classList.contains('correct')) {
      span.className = 'word correct';
    }
  });

  const idx = currentSentenceIndex % CUMLELER.length;
  const sonrakiVar = (idx + 1) < CUMLELER.length;

  congratsBanner.textContent = sonrakiVar
    ? 'ğŸ‰ Harika! Sonraki cÃ¼mleye geÃ§iliyor...'
    : 'ğŸ† Tebrikler! TÃ¼m cÃ¼mleleri tamamladÄ±n!';
  congratsBanner.classList.add('visible');

  micStatus.textContent = 'ğŸ‰ Harika iÅŸ Ã§Ä±kardÄ±n!';
  micStatus.classList.remove('listening');
  micIndicator.classList.remove('active');

  // ButonlarÄ± geÃ§iÅŸ sÃ¼resi boyunca kilitle
  btnStart.disabled = true;
  btnStop.disabled = true;

  setTimeout(() => {
    congratsBanner.classList.remove('visible');

    if (sonrakiVar) {
      // Sonraki cÃ¼mleye geÃ§
      currentSentenceIndex++;
      btnStop.disabled = false;
      oyunuSifirlaVeBaslat();
    } else {
      // TÃ¼m cÃ¼mleler bitti â€” baÅŸa dÃ¶n, skoru sÄ±fÄ±rla
      currentSentenceIndex = 0;
      score = 0;
      scoreDisplay.textContent = '0';
      btnStart.disabled = false;
      btnStop.disabled = true;
      micStatus.textContent = 'BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas';
    }
  }, 2000);
}

// â”€â”€â”€ TanÄ±ma baÅŸlat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startRecognition() {
  if (!SpeechRecognition) return;
  if (oyunBitti) return;

  if (recognition) {
    try { recognition.abort(); } catch(e) {}
    recognition = null;
  }

  // TTS konuÅŸuyorsa baÅŸlatma â€” utterance.onend halleder
  if (window.speechSynthesis && window.speechSynthesis.speaking) return;

  errorMsg.classList.remove('visible');
  errorMsg.textContent = '';
  lastError = null;

  try {
    recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';
    recognition.continuous = false;
    recognition.interimResults = true;
    recognition.maxAlternatives = 5;

    recognition.onresult = handleSpeechResult;
    recognition.onerror  = handleSpeechError;
    recognition.onend    = handleRecognitionEnd;

    recognition.start();
    isListening = true;

    micIndicator.classList.add('active');
    micStatus.classList.add('listening');
    micStatus.textContent = 'ğŸ¤ Dinliyorum...';
  } catch (hata) {
    gosterHata('TanÄ±ma baÅŸlatÄ±lamadÄ±: ' + hata.message);
    isListening = false;
    btnStart.disabled = false;
    btnStop.disabled = true;
  }
}

// â”€â”€â”€ TanÄ±ma durdur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function stopRecognition() {
  isListening = false;

  if (restartDebounceTimer) {
    clearTimeout(restartDebounceTimer);
    restartDebounceTimer = null;
  }

  if (recognition) {
    try { recognition.abort(); } catch(e) {}
    recognition = null;
  }

  micIndicator.classList.remove('active');
  micStatus.classList.remove('listening');
  micStatus.textContent = 'BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas';
  interimText.textContent = '';
}

// â”€â”€â”€ KonuÅŸma sonucu iÅŸle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleSpeechResult(event) {
  try {
    if (!event || !event.results) return;
    if (oyunBitti || currentWordIndex >= targetWords.length) return;

    let interimTranscript = '';
    let finalGeldi = false;

    for (let i = 0; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        finalGeldi = true;
      } else {
        interimTranscript += event.results[i][0].transcript + ' ';
      }
    }

    interimText.textContent = interimTranscript.trim() ||
      event.results[event.results.length - 1][0].transcript;

    // 1. Interim'de hedefi ara
    if (!interimKabulEdildi && interimTranscript) {
      const interimKelimeler = normalizeText(interimTranscript);
      if (transcriptIsleBul(interimKelimeler)) {
        interimKabulEdildi = true;
        validateWord(true);
        return;
      }
    }

    // 2. Final result iÅŸle
    if (finalGeldi && !interimKabulEdildi) {
      let eslesti = false;

      for (let i = event.resultIndex; i < event.results.length; i++) {
        if (!event.results[i].isFinal) continue;
        const result = event.results[i];

        for (let a = 0; a < result.length && !eslesti; a++) {
          const kelimeler = normalizeText(result[a].transcript);
          if (transcriptIsleBul(kelimeler)) {
            eslesti = true;
            validateWord(true);
          }
        }
      }

      if (!eslesti) {
        validateWord(false);
      }
    }

    if (finalGeldi) {
      interimKabulEdildi = false;
    }

  } catch (hata) {
    // Sessizce yoksay
  }
}

// â”€â”€â”€ Hata iÅŸle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleSpeechError(event) {
  try {
    lastError = event.error;

    if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
      gosterHata('Mikrofon izni reddedildi. LÃ¼tfen tarayÄ±cÄ± ayarlarÄ±ndan izin ver.');
      isListening = false;
      btnStart.disabled = false;
      btnStop.disabled = true;
    } else if (event.error === 'no-speech') {
      // onend halleder
    } else if (event.error === 'network') {
      gosterHata('AÄŸ hatasÄ±. Ä°nternet baÄŸlantÄ±nÄ± kontrol et.');
    }
  } catch (hata) {
    // Sessizce yoksay
  }
}

// â”€â”€â”€ TanÄ±ma bitti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleRecognitionEnd() {
  if (!isListening) return;
  if (lastError === 'not-allowed' || lastError === 'service-not-allowed') return;
  if (oyunBitti) return;

  // TTS konuÅŸuyo
