<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sesli Okuma Oyunu</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1b2d;
    --surface: #1a2d46;
    --surface2: #223558;
    --accent: #ffd166;
    --accent2: #06d6a0;
    --red: #ef476f;
    --green: #06d6a0;
    --yellow: #ffd166;
    --text: #e8f4fd;
    --text-muted: #7fa8c9;
    --radius: 20px;
    --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Baloo 2', cursive;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }
  .stars { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
  .star {
    position: absolute; border-radius: 50%; background: white;
    animation: twinkle var(--d, 3s) ease-in-out infinite;
    animation-delay: var(--delay, 0s); opacity: 0.3;
  }
  @keyframes twinkle {
    0%,100% { opacity: 0.1; transform: scale(0.8); }
    50% { opacity: 0.7; transform: scale(1.2); }
  }
  .game-container {
    position: relative; z-index: 1;
    width: min(90vw, 660px);
    display: flex; flex-direction: column;
    align-items: center; gap: 18px;
  }
  .title-area { text-align: center; }
  .title-area h1 {
    font-family: 'Nunito', sans-serif; font-weight: 900;
    font-size: clamp(1.6rem, 5vw, 2.6rem); color: var(--accent);
    text-shadow: 0 0 20px rgba(255,209,102,0.4), 0 4px 8px rgba(0,0,0,0.5);
    letter-spacing: -0.5px;
  }
  .subtitle { font-size: 0.9rem; color: var(--text-muted); margin-top: 4px; }

  .info-bar {
    background: var(--surface); border: 2px solid var(--surface2);
    border-radius: var(--radius); padding: 10px 24px; width: 100%;
    display: flex; align-items: center; justify-content: space-between;
    gap: 12px; box-shadow: var(--shadow); flex-wrap: wrap;
  }
  .info-item { display: flex; flex-direction: column; align-items: center; gap: 2px; }
  .info-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
  .info-value { font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 1.5rem; color: var(--accent); line-height: 1; }
  .info-value.bump { animation: scoreBump 0.3s ease; }
  @keyframes scoreBump {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); color: #fff; }
    100% { transform: scale(1); }
  }
  .info-seviye { font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.95rem; color: var(--accent2); text-align: center; }
  .info-kelime { font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1rem; color: var(--text); }

  .word-card-wrapper { position: relative; width: 100%; }
  .word-card {
    background: var(--surface); border: 2px solid var(--surface2);
    border-radius: var(--radius); padding: 36px 40px; width: 100%;
    box-shadow: var(--shadow); display: flex; justify-content: center;
    align-items: center; gap: 16px; flex-wrap: wrap; min-height: 130px;
  }

  .btn-gec {
    position: absolute; bottom: 10px; right: 14px;
    font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.78rem;
    padding: 5px 14px; border: 1px solid var(--surface2); border-radius: 50px;
    background: rgba(255,255,255,0.04); color: var(--text-muted);
    cursor: pointer; opacity: 0.5; transition: opacity 0.2s, background 0.2s;
  }
  .btn-gec:hover:not(:disabled) { opacity: 1; background: rgba(255,255,255,0.1); }
  .btn-gec:disabled { opacity: 0.15; cursor: not-allowed; }

  .word {
    font-family: 'Nunito', sans-serif; font-weight: 900;
    font-size: clamp(2rem, 8vw, 3.5rem); padding: 8px 18px;
    border-radius: 14px; border: 3px solid transparent;
    transition: all 0.25s ease; cursor: default;
    letter-spacing: 0.5px; color: var(--text); background: transparent;
  }
  .word.active {
    background: rgba(255,209,102,0.15); border-color: var(--yellow);
    color: var(--yellow); transform: scale(1.08);
    box-shadow: 0 0 20px rgba(255,209,102,0.3);
    animation: pulse 1.2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { box-shadow: 0 0 20px rgba(255,209,102,0.3); }
    50% { box-shadow: 0 0 36px rgba(255,209,102,0.6); }
  }
  .word.correct {
    background: rgba(6,214,160,0.15); border-color: var(--green); color: var(--green);
    animation: correctPop 0.4s ease forwards;
  }
  @keyframes correctPop {
    0% { transform: scale(1); }
    40% { transform: scale(1.15) rotate(-2deg); }
    70% { transform: scale(0.97) rotate(1deg); }
    100% { transform: scale(1) rotate(0deg); }
  }
  .word.wrong {
    background: rgba(239,71,111,0.15); border-color: var(--red); color: var(--red);
    animation: shake 0.4s ease;
  }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .feedback-bubble {
    font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1rem;
    min-height: 26px; text-align: center; color: var(--accent2);
    transition: opacity 0.3s; opacity: 0;
  }
  .feedback-bubble.show { opacity: 1; }
  .feedback-bubble.yanlis { color: var(--text-muted); font-style: italic; }

  .mic-area { display: flex; flex-direction: column; align-items: center; gap: 8px; }
  .mic-indicator {
    width: 72px; height: 72px; border-radius: 50%;
    background: var(--surface); border: 3px solid var(--surface2);
    display: flex; align-items: center; justify-content: center;
    font-size: 1.8rem; transition: all 0.3s ease; box-shadow: var(--shadow);
  }
  .mic-indicator.active {
    background: rgba(239,71,111,0.15); border-color: var(--red);
    animation: micPulse 1s ease-in-out infinite;
  }
  .mic-indicator.speaking {
    background: rgba(255,209,102,0.15); border-color: var(--yellow);
    animation: speakPulse 0.8s ease-in-out infinite;
  }
  @keyframes micPulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(239,71,111,0.4); }
    50% { box-shadow: 0 0 0 16px rgba(239,71,111,0); }
  }
  @keyframes speakPulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(255,209,102,0.4); }
    50% { box-shadow: 0 0 0 16px rgba(255,209,102,0); }
  }
  .mic-status { font-size: 0.82rem; color: var(--text-muted); text-align: center; min-height: 20px; transition: color 0.3s; }
  .mic-status.listening { color: var(--red); }
  .mic-status.speaking { color: var(--yellow); }
  .interim-text { font-size: 0.88rem; color: var(--text-muted); font-style: italic; min-height: 20px; text-align: center; max-width: 400px; }

  .button-row { display: flex; gap: 16px; }
  .btn {
    font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 1.1rem;
    padding: 14px 36px; border: none; border-radius: 50px; cursor: pointer;
    transition: all 0.2s ease; box-shadow: 0 4px 14px rgba(0,0,0,0.3); letter-spacing: 0.5px;
  }
  .btn:active { transform: scale(0.96); }
  .btn-start { background: linear-gradient(135deg, var(--green), #04b88a); color: #0a2a1f; }
  .btn-start:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(6,214,160,0.4); }
  .btn-stop { background: linear-gradient(135deg, var(--red), #d63060); color: #000; }
  .btn-stop:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(239,71,111,0.4); }
  .btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none !important; box-shadow: none; }

  .level-overlay {
    display: none; position: absolute; inset: 0;
    border-radius: var(--radius); background: rgba(15,27,45,0.96);
    flex-direction: column; align-items: center; justify-content: center;
    gap: 14px; z-index: 10;
  }
  .level-overlay.visible { display: flex; animation: overlayIn 0.35s ease; }
  @keyframes overlayIn {
    0% { opacity: 0; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
  }
  .level-overlay-title {
    font-family: 'Nunito', sans-serif; font-weight: 900;
    font-size: clamp(1.3rem,5vw,1.9rem); color: var(--accent); text-align: center;
  }
  .level-overlay-sub { font-size: 1rem; color: var(--text-muted); text-align: center; }
  .btn-next-level {
    font-family: 'Nunito', sans-serif; font-weight: 900; font-size: 1.05rem;
    padding: 12px 32px; border: none; border-radius: 50px; cursor: pointer;
    background: linear-gradient(135deg, var(--accent), #ff9f1c); color: #1a0a00;
    box-shadow: 0 4px 18px rgba(255,209,102,0.4); transition: transform 0.2s;
  }
  .btn-next-level:hover { transform: translateY(-2px); }

  .congrats-banner {
    display: none; background: linear-gradient(135deg, #ffd166, #ff9f1c);
    color: #1a0a00; font-family: 'Nunito', sans-serif; font-weight: 900;
    font-size: clamp(1.3rem,5vw,1.9rem); padding: 18px 40px;
    border-radius: var(--radius); text-align: center; width: 100%;
    box-shadow: 0 8px 32px rgba(255,209,102,0.5);
  }
  .congrats-banner.visible { display: block; animation: congratsIn 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards; }
  @keyframes congratsIn {
    0% { transform: scale(0.5) rotate(-4deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  .word-placeholder {
    font-family: 'Nunito', sans-serif; font-weight: 700;
    font-size: 1.1rem; color: var(--text-muted); text-align: center;
  }

  .error-msg {
    display: none; color: var(--red); font-size: 0.9rem; text-align: center;
    background: rgba(239,71,111,0.1); border: 1px solid rgba(239,71,111,0.3);
    border-radius: 12px; padding: 10px 20px; width: 100%;
  }
  .error-msg.visible { display: block; }
  .no-support { display: none; color: var(--accent); text-align: center; font-size: 1.1rem; padding: 20px; }
  .no-support.visible { display: block; }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="game-container">

  <div class="title-area">
    <h1>ğŸŒŸ Sesli Okuma Oyunu</h1>
    <p class="subtitle">Kelimeyi sesli oku ve puan kazan!</p>
  </div>

  <div class="info-bar">
    <div class="info-item">
      <div class="info-label">Puan</div>
      <div class="info-value" id="scoreDisplay">0</div>
    </div>
    <div class="info-item">
      <div class="info-label">Seviye</div>
      <div class="info-seviye" id="seviyeDisplay">â€”</div>
    </div>
    <div class="info-item">
      <div class="info-label">Kelime</div>
      <div class="info-kelime" id="kelimeDisplay">â€”</div>
    </div>
  </div>

  <div class="word-card-wrapper">
    <div class="word-card" id="wordCard">
      <div class="word-placeholder">â–¶ BaÅŸla dÃ¼ÄŸmesine bas</div>
    </div>
    <div class="level-overlay" id="levelOverlay">
      <div class="level-overlay-title" id="overlayTitle">ğŸ‰ Seviye TamamlandÄ±!</div>
      <div class="level-overlay-sub" id="overlaySub"></div>
      <button class="btn-next-level" id="btnNextLevel">Sonraki Seviye â†’</button>
    </div>
    <button class="btn-gec" id="btnGec" disabled>GeÃ§ â†’</button>
  </div>

  <div class="feedback-bubble" id="feedbackBubble"></div>

  <div class="mic-area">
    <div class="mic-indicator" id="micIndicator">ğŸ¤</div>
    <div class="mic-status" id="micStatus">BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas</div>
  </div>

  <div class="interim-text" id="interimText"></div>

  <div class="button-row">
    <button class="btn btn-start" id="btnStart">â–¶ BaÅŸla</button>
    <button class="btn btn-stop" id="btnStop" disabled>ğŸ”„ SÄ±fÄ±rla</button>
  </div>

  <div class="congrats-banner" id="congratsBanner">
    ğŸ† TÃ¼m seviyeleri tamamladÄ±n! SÃ¼persin! ğŸ†
  </div>

  <div class="error-msg" id="errorMsg"></div>
  <div class="no-support" id="noSupport">
    ğŸ˜” TarayÄ±cÄ±n sesli tanÄ±mayÄ± desteklemiyor. LÃ¼tfen Google Chrome kullan.
  </div>

</div>

<script>
"use strict";

// â”€â”€â”€ YÄ±ldÄ±z arka planÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  var frag = document.createDocumentFragment();
  for (var i = 0; i < 80; i++) {
    var s = document.createElement('div');
    s.className = 'star';
    var b = Math.random() * 3 + 1;
    s.style.cssText = 'width:'+b+'px;height:'+b+'px;left:'+(Math.random()*100)+'%;top:'+(Math.random()*100)+'%;--d:'+(2+Math.random()*4)+'s;--delay:'+(Math.random()*5)+'s;';
    frag.appendChild(s);
  }
  document.getElementById('stars').appendChild(frag);
})();

// â”€â”€â”€ TarayÄ±cÄ± desteÄŸi â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SR = window.SpeechRecognition || window.webkitSpeechRecognition;

// â”€â”€â”€ DOM referanslarÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var btnStart       = document.getElementById('btnStart');
var btnStop        = document.getElementById('btnStop');
var btnGec         = document.getElementById('btnGec');
var btnNextLevel   = document.getElementById('btnNextLevel');
var wordCard       = document.getElementById('wordCard');
var scoreDisplay   = document.getElementById('scoreDisplay');
var seviyeDisplay  = document.getElementById('seviyeDisplay');
var kelimeDisplay  = document.getElementById('kelimeDisplay');
var micIndicator   = document.getElementById('micIndicator');
var micStatus      = document.getElementById('micStatus');
var interimText    = document.getElementById('interimText');
var congratsBanner = document.getElementById('congratsBanner');
var errorMsg       = document.getElementById('errorMsg');
var feedbackBubble = document.getElementById('feedbackBubble');
var levelOverlay   = document.getElementById('levelOverlay');
var overlayTitle   = document.getElementById('overlayTitle');
var overlaySub     = document.getElementById('overlaySub');

if (!SR) {
  document.getElementById('noSupport').classList.add('visible');
  btnStart.disabled = true;
}

// â”€â”€â”€ Kelime veritabanÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var SEVIYELER = [
  {
    seviye: 1, baslik: 'Tek Hece', puan: 10,
    kelimeler: ['at','it','ev','su','el','ip','ot','bal','gÃ¶z','kÄ±z','yol','taÅŸ','kuÅŸ','kar','top','Ã§am','dal','gÃ¼l','kol','yaÅŸ']
  },
  {
    seviye: 2, baslik: 'Ä°ki Hece', puan: 15,
    kelimeler: ['anne','baba','araba','okul','kedi','elma','masa','kitap','kapÄ±','kalem','defter','kÃ¶pek','Ã§iÃ§ek','bulut','deniz','yÄ±ldÄ±z','bebek','bahÃ§e','pencere','Ã§anta']
  },
  {
    seviye: 3, baslik: 'ÃœÃ§ Hece', puan: 20,
    kelimeler: ['armut','portakal','bilgisayar','kelebek','sincap','tavÅŸan','telefon','otobÃ¼s','Ã§ikolata','maymun','fÄ±rtÄ±na','kÃ¶prÃ¼','traktÃ¶r','aslan','kahraman']
  },
  {
    seviye: 4, baslik: 'KÄ±sa CÃ¼mle', puan: 30,
    kelimeler: ['Ali topu at','Kedi sÃ¼t iÃ§','Anne eve gel','KuÅŸ uÃ§tu gitti','Baba arabaya bin','Top yukarÄ± git','BalÄ±k suda yÃ¼zdÃ¼']
  },
  {
    seviye: 5, baslik: 'Uzun CÃ¼mle', puan: 40,
    kelimeler: ['Fatma okula gitti','KÃ¼Ã§Ã¼k kedi uyudu','Ali ve AyÅŸe bahÃ§ede oynadÄ±','Annem marketten ekmek aldÄ±','KÃ¶pek bahÃ§ede neÅŸeyle koÅŸtu']
  }
];

var DOGRU_MESAJLAR = ['HarikasÄ±n!','Ã‡ok iyi!','SÃ¼persin!','Bravo!','MÃ¼kemmel!','Aferin!','Devam et!'];

// â”€â”€â”€ Oyun durumu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var targetWords        = [];
var wordSpans          = [];
var currentWordIndex   = 0;
var score              = 0;
var currentSeviye      = 0;
var currentKelimeIndex = 0;
var yanlisSayisi       = 0;
var ustUsteDogruSayisi = 0;
var oyunBasladi        = false;
var feedbackTimer      = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SpeechController â€” TTS ve Recognition lifecycle'Ä±nÄ± merkezi olarak yÃ¶netir.
// Temel kural: TTS aktifken Recognition kapalÄ±, Recognition aktifken TTS kapalÄ±.
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var SpeechController = (function() {

  // â”€â”€ Dahili durum â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  var recognition    = null;
  var recState       = 'idle';   // 'idle' | 'starting' | 'listening' | 'stopping'
  var isSpeaking     = false;
  var silenceTimer   = null;
  var restartTimer   = null;
  var lastError      = null;
  var pendingRestart = false;   // TTS bitince mikrofon aÃ§Ä±lsÄ±n mÄ±?
  var trVoiceCache   = null;

  // â”€â”€ Ses seÃ§imi â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getTrVoice() {
    if (trVoiceCache) return trVoiceCache;
    var voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
    trVoiceCache = voices.find(function(v){ return v.lang === 'tr-TR' && v.localService; })
                || voices.find(function(v){ return v.lang === 'tr-TR'; })
                || null;
    return trVoiceCache;
  }
  if (window.speechSynthesis) {
    window.speechSynthesis.onvoiceschanged = function() {
      trVoiceCache = null;
      getTrVoice();
    };
  }

  // â”€â”€ Recognition iÃ§ yardÄ±mcÄ±lar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clearTimers() {
    if (silenceTimer) { clearTimeout(silenceTimer); silenceTimer = null; }
    if (restartTimer) { clearTimeout(restartTimer); restartTimer = null; }
  }

  function resetSilenceTimer() {
    if (silenceTimer) clearTimeout(silenceTimer);
    if (recState !== 'listening') return;
    silenceTimer = setTimeout(function() {
      if (recState === 'listening' && oyunBasladi && !isSpeaking) {
        _stopRecognition(true); // sessizlik â†’ kÄ±sa restart
      }
    }, 2000);
  }

  function _buildRecognition() {
    if (!SR) return;
    // Ã–nceki instance'Ä± temizle
    if (recognition) {
      recognition.onresult = null;
      recognition.onerror  = null;
      recognition.onend    = null;
      recognition.onspeechstart = null;
      try { recognition.abort(); } catch(e) {}
      recognition = null;
    }
    recognition = new SR();
    recognition.lang            = 'tr-TR';
    recognition.continuous      = false;
    recognition.interimResults  = true;
    recognition.maxAlternatives = 5;
    recognition.onresult = _onResult;
    recognition.onerror  = _onError;
    recognition.onend    = _onEnd;
    recognition.onspeechstart = function() { resetSilenceTimer(); };
  }

  function _onResult(event) {
    if (!event || !event.results) return;
    if (isSpeaking) return; // TTS aktifken sonuÃ§larÄ± yok say (echo korumasÄ±)

    var last = event.results[event.results.length - 1];
    interimText.textContent = last[0].transcript;
    resetSilenceTimer();

    for (var i = event.resultIndex; i < event.results.length; i++) {
      if (!event.results[i].isFinal) continue;
      if (currentWordIndex < targetWords.length) {
        var best = checkAlternatives(event.results[i]);
        if (best) validateWord(best);
      }
    }
  }

  function _onError(event) {
    lastError = event.error;
    if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
      errorMsg.textContent = 'Mikrofon izni reddedildi. TarayÄ±cÄ± ayarlarÄ±ndan izin ver.';
      errorMsg.classList.add('visible');
      recState    = 'idle';
      oyunBasladi = false;
      btnStart.disabled = false;
      btnStop.disabled  = true;
      return;
    }
    if (event.error === 'network') {
      errorMsg.textContent = 'AÄŸ hatasÄ±. Ä°nternet baÄŸlantÄ±nÄ± kontrol et.';
      errorMsg.classList.add('visible');
    }
    // 'no-speech', 'aborted' â†’ onEnd ile yÃ¶netilir
  }

  function _onEnd() {
    // KasÄ±tlÄ± durdurulmuÅŸsa restart istemiyoruz
    if (recState === 'stopping') {
      recState = 'idle';
      return;
    }
    recState = 'idle';

    // TTS aktifse veya oyun bittiyse restart yok
    if (!oyunBasladi || isSpeaking) return;
    if (lastError === 'not-allowed' || lastError === 'service-not-allowed') return;

    // KÄ±sa gecikme ile gÃ¼venli restart
    _scheduleRestart(300);
  }

  function _scheduleRestart(delay) {
    if (restartTimer) clearTimeout(restartTimer);
    restartTimer = setTimeout(function() {
      restartTimer = null;
      if (oyunBasladi && !isSpeaking && recState === 'idle') {
        _startRecognition();
      }
    }, delay || 300);
  }

  function _startRecognition() {
    if (!SR) return;
    if (recState === 'starting' || recState === 'listening') return;
    if (isSpeaking) return;
    if (lastError === 'not-allowed' || lastError === 'service-not-allowed') return;

    errorMsg.classList.remove('visible');
    lastError = null;
    _buildRecognition();
    recState = 'starting';

    try {
      recognition.start();
      recState = 'listening';
      resetSilenceTimer();
      micIndicator.className = 'mic-indicator active';
      micStatus.className    = 'mic-status listening';
      micStatus.textContent  = 'ğŸ¤ Dinliyorum...';
      interimText.textContent = '';
    } catch(e) {
      recState = 'idle';
      // Zaten baÅŸlatÄ±lmÄ±ÅŸ hatasÄ± olabilir, bir sÃ¼re sonra tekrar dene
      if (e.name === 'InvalidStateError') {
        _scheduleRestart(500);
      } else {
        errorMsg.textContent = 'Mikrofon baÅŸlatÄ±lamadÄ±: ' + e.message;
        errorMsg.classList.add('visible');
      }
    }
  }

  function _stopRecognition(scheduleRestart) {
    clearTimers();
    if (recState === 'idle') return;
    recState = 'stopping';
    if (recognition) { try { recognition.stop(); } catch(e) {} }
    micIndicator.className = 'mic-indicator';
    micStatus.className    = 'mic-status';
    micStatus.textContent  = isSpeaking ? 'ğŸ”Š Dinle...' : 'BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas';
    interimText.textContent = '';
    // onEnd'de recState = 'idle' olacak, oradan restart
    if (scheduleRestart) {
      pendingRestart = true;
    }
  }

  // â”€â”€ Public API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return {

    // Sadece yanlÄ±ÅŸ okumada Ã§aÄŸrÄ±lÄ±r (veya Ã¶ÄŸretici TTS iÃ§in)
    speak: function(text, opts, onDone) {
      if (!window.speechSynthesis) {
        if (onDone) onDone();
        return;
      }
      opts = opts || {};
      var rate  = opts.rate  || 0.82;
      var pitch = opts.pitch || 1.08;

      // Mevcut TTS'i iptal et
      window.speechSynthesis.cancel();

      // Recognition'Ä± gÃ¼venle durdur (TTS sÄ±rasÄ±nda aktif olmamalÄ±)
      if (recState === 'listening' || recState === 'starting') {
        _stopRecognition(false);
      }
      clearTimers(); // Restart timer'larÄ±nÄ± da temizle

      isSpeaking = true;
      pendingRestart = false;

      // Mikrofon gÃ¶stergesini konuÅŸma moduna al
      micIndicator.className = 'mic-indicator speaking';
      micStatus.className    = 'mic-status speaking';
      micStatus.textContent  = 'ğŸ”Š Dinle...';
      interimText.textContent = '';

      var ut    = new SpeechSynthesisUtterance(text);
      ut.lang   = 'tr-TR';
      ut.rate   = rate;
      ut.pitch  = pitch;
      ut.volume = 1;
      var voice = getTrVoice();
      if (voice) ut.voice = voice;

      ut.onend = function() {
        isSpeaking = false;
        // Mikrofon gÃ¶stergesini sÄ±fÄ±rla
        micIndicator.className = 'mic-indicator';
        micStatus.className    = 'mic-status';
        micStatus.textContent  = '';
        interimText.textContent = '';

        if (onDone) onDone();

        // Oyun devam ediyorsa mikrofonu aÃ§
        if (oyunBasladi) {
          _scheduleRestart(250);
        }
      };

      ut.onerror = function() {
        isSpeaking = false;
        micIndicator.className = 'mic-indicator';
        micStatus.className    = 'mic-status';
        if (onDone) onDone();
        if (oyunBasladi) _scheduleRestart(300);
      };

      window.speechSynthesis.speak(ut);
    },

    // TanÄ±mayÄ± baÅŸlat (oyun baÅŸlangÄ±cÄ± / seviye geÃ§iÅŸi sonrasÄ±)
    startListening: function() {
      if (!isSpeaking) {
        _scheduleRestart(100);
      }
      // isSpeaking ise speak().onend iÃ§inden otomatik baÅŸlar
    },

    // Tam durdur (oyun bitti / sÄ±fÄ±rla)
    stopAll: function() {
      isSpeaking = false;
      pendingRestart = false;
      if (window.speechSynthesis) window.speechSynthesis.cancel();
      clearTimers();
      // Recognition'Ä± durdur ama restart bekleme
      if (recState !== 'idle') {
        recState = 'stopping';
        if (recognition) { try { recognition.stop(); } catch(e) {} }
        // onEnd fired â†’ recState = 'idle'
      }
      micIndicator.className = 'mic-indicator';
      micStatus.className    = 'mic-status';
      micStatus.textContent  = 'BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas';
      interimText.textContent = '';
    },

    // Sadece TTS iptal (recognition dokunma)
    cancelSpeech: function() {
      if (window.speechSynthesis) window.speechSynthesis.cancel();
      isSpeaking = false;
    },

    isSpeaking: function() { return isSpeaking; },
    isListening: function() { return recState === 'listening'; }
  };
})();

// â”€â”€â”€ TÃ¼rkÃ§e normalizasyon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function normalizeText(metin) {
  if (!metin || typeof metin !== 'string') return [];
  var s = metin.replace(/I/g, 'Ä±').replace(/Ä°/g, 'i').toLocaleLowerCase('tr-TR');
  s = s.replace(/[^\p{L}\s]/gu, '');
  return s.split(/\s+/).filter(function(t){ return t.length > 0; });
}

// â”€â”€â”€ Levenshtein â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function levenshtein(a, b) {
  var m = a.length, n = b.length;
  if (!m) return n;
  if (!n) return m;
  var dp = [];
  for (var i = 0; i <= m; i++) { dp[i] = [i]; }
  for (var j = 0; j <= n; j++) { dp[0][j] = j; }
  for (var i2 = 1; i2 <= m; i2++) {
    for (var j2 = 1; j2 <= n; j2++) {
      dp[i2][j2] = a[i2-1] === b[j2-1]
        ? dp[i2-1][j2-1]
        : 1 + Math.min(dp[i2-1][j2], dp[i2][j2-1], dp[i2-1][j2-1]);
    }
  }
  return dp[m][n];
}

// â”€â”€â”€ ToleranslÄ± eÅŸleÅŸme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kelimeEslesir(konusulan, hedef) {
  if (konusulan === hedef) return true;
  var dist     = levenshtein(konusulan, hedef);
  var tolerans = hedef.length <= 3 ? 1 : hedef.length <= 6 ? 2 : 3;
  return dist <= Math.min(tolerans, Math.floor(Math.max(hedef.length, konusulan.length) * 0.40));
}

// â”€â”€â”€ TÃ¼m alternatifleri kontrol â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkAlternatives(result) {
  for (var a = 0; a < result.length; a++) {
    var tokenler = normalizeText(result[a].transcript);
    if (!tokenler.length) continue;
    if (kelimeEslesir(tokenler[0], targetWords[currentWordIndex])) return tokenler[0];
  }
  var fallback = normalizeText(result[0].transcript);
  return fallback[0] || '';
}

// â”€â”€â”€ Geri bildirim gÃ¶ster â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gosterGeri(mesaj, tip) {
  if (feedbackTimer) clearTimeout(feedbackTimer);
  feedbackBubble.textContent = mesaj;
  feedbackBubble.className   = 'feedback-bubble show' + (tip === 'yanlis' ? ' yanlis' : '');
  feedbackTimer = setTimeout(function(){
    feedbackBubble.classList.remove('show');
  }, 2500);
}

// â”€â”€â”€ Info bar gÃ¼ncelle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateInfoBar() {
  var sev = SEVIYELER[currentSeviye];
  seviyeDisplay.textContent = sev.seviye + '. ' + sev.baslik;
  kelimeDisplay.textContent = (currentKelimeIndex + 1) + ' / ' + sev.kelimeler.length;
}

// â”€â”€â”€ Skor gÃ¼ncelle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateScore(ekle) {
  score += ekle;
  scoreDisplay.textContent = score;
  scoreDisplay.classList.remove('bump');
  void scoreDisplay.offsetWidth;
  scoreDisplay.classList.add('bump');
}

// â”€â”€â”€ Kelimeyi yÃ¼kle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kelimeyiYukle() {
  var sev    = SEVIYELER[currentSeviye];
  var metin  = sev.kelimeler[currentKelimeIndex];
  targetWords      = normalizeText(metin);
  currentWordIndex = 0;
  yanlisSayisi     = 0;

  var orijinal = metin.split(/\s+/);
  var frag     = document.createDocumentFragment();
  wordSpans    = [];

  for (var i = 0; i < targetWords.length; i++) {
    var span = document.createElement('span');
    span.className   = 'word' + (i === 0 ? ' active' : '');
    span.textContent = orijinal[i] || targetWords[i];
    frag.appendChild(span);
    wordSpans.push(span);
  }

  wordCard.innerHTML = '';
  wordCard.appendChild(frag);
  btnGec.disabled = false;
  updateInfoBar();

  // Ã–ÄŸretmen modeli: yeni kelimeyi sesli oku, bittikten sonra mikrofon aÃ§Ä±lÄ±r
  setTimeout(function() {
    SpeechController.speak(metin, { rate: 0.78, pitch: 1.10 });
  }, 300);
}

// â”€â”€â”€ Kelimeyi geÃ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gecKelime() {
  if (!oyunBasladi) return;
  btnGec.disabled = true;
  var hedefMetin = SEVIYELER[currentSeviye].kelimeler[currentKelimeIndex];
  gosterGeri('DoÄŸrusu: ' + hedefMetin, 'yanlis');
  // TTS â†’ onend'de mikrofon aÃ§Ä±lÄ±r, sonra kelime geÃ§ilir
  SpeechController.speak('DoÄŸrusu ÅŸuydu: ' + hedefMetin, { rate: 0.80, pitch: 1.05 });
  setTimeout(sonrakiKelimeyeGec, 2000);
}

// â”€â”€â”€ Sonraki kelimeye geÃ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sonrakiKelimeyeGec() {
  if (!oyunBasladi) return;
  currentKelimeIndex++;
  var sev = SEVIYELER[currentSeviye];
  if (currentKelimeIndex >= sev.kelimeler.length) {
    seviyeTamamlandi();
  } else {
    kelimeyiYukle();
  }
}

// â”€â”€â”€ Seviye tamamlandÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function seviyeTamamlandi() {
  btnGec.disabled = true;
  var sev = SEVIYELER[currentSeviye];

  if (currentSeviye >= SEVIYELER.length - 1) {
    oyunBasladi = false;
    SpeechController.stopAll();
    congratsBanner.classList.add('visible');
    btnStop.disabled  = true;
    btnStart.disabled = false;
    micStatus.textContent = 'ğŸ† TÃ¼m seviyeleri bitirdin!';
    micIndicator.className = 'mic-indicator';
    // BitiriÅŸ sesi â€” mikrofon aÃ§Ä±lmasÄ±n
    SpeechController.cancelSpeech();
    if (window.speechSynthesis) {
      var ut    = new SpeechSynthesisUtterance('Tebrikler! TÃ¼m seviyeleri tamamladÄ±n! SÃ¼persin!');
      ut.lang   = 'tr-TR';
      ut.rate   = 0.85;
      ut.pitch  = 1.10;
      ut.volume = 1;
      window.speechSynthesis.speak(ut);
    }
    return;
  }

  overlayTitle.textContent = 'ğŸ‰ Seviye ' + sev.seviye + ' TamamlandÄ±!';
  overlaySub.textContent   = 'Toplam Puan: ' + score;
  levelOverlay.classList.add('visible');
  SpeechController.stopAll();
  // Seviye tamamlandÄ± sesi â€” bu sÄ±rada mikrofon kapalÄ± kalmalÄ±
  if (window.speechSynthesis) {
    var ut2    = new SpeechSynthesisUtterance('Seviye ' + sev.seviye + ' tamamlandÄ±! HarikasÄ±n!');
    ut2.lang   = 'tr-TR';
    ut2.rate   = 0.85;
    ut2.pitch  = 1.10;
    ut2.volume = 1;
    window.speechSynthesis.speak(ut2);
  }
}

// â”€â”€â”€ Sonraki seviye â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sonrakiSeviyeyeGec() {
  levelOverlay.classList.remove('visible');
  currentSeviye++;
  currentKelimeIndex    = 0;
  ustUsteDogruSayisi    = 0;
  kelimeyiYukle();
  // kelimeyiYukle iÃ§inde seslendir Ã§aÄŸrÄ±lÄ±r, onend'de mikrofon aÃ§Ä±lÄ±r
}

// â”€â”€â”€ Kelime doÄŸrulama â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function validateWord(konusulanKelime) {
  if (!oyunBasladi) return;
  if (currentWordIndex >= targetWords.length) return;

  var tokenler = normalizeText(konusulanKelime);
  if (!tokenler.length) return;

  var token = tokenler[0];
  var hedef = targetWords[currentWordIndex];
  var span  = wordSpans[currentWordIndex];

  if (kelimeEslesir(token, hedef)) {
    // âœ… DoÄŸru â€” ses YOK
    span.className = 'word correct';
    currentWordIndex++;

    if (currentWordIndex < targetWords.length) {
      requestAnimationFrame(function() {
        wordSpans[currentWordIndex].className = 'word active';
      });
    }

    if (currentWordIndex >= targetWords.length) {
      ustUsteDogruSayisi++;
      updateScore(SEVIYELER[currentSeviye].puan);
      yanlisSayisi = 0;

      var msg = DOGRU_MESAJLAR[Math.floor(Math.random() * DOGRU_MESAJLAR.length)];
      if (ustUsteDogruSayisi > 0 && ustUsteDogruSayisi % 3 === 0) {
        msg = 'MÃ¼kemmel gidiyorsun!';
        gosterGeri(msg + ' ğŸ”¥', 'dogru');
      } else {
        gosterGeri(msg + ' ğŸŒŸ', 'dogru');
      }

      // DoÄŸru okumada TTS YOK â€” sadece kÄ±sa gecikme ile geÃ§
      setTimeout(sonrakiKelimeyeGec, 700);
    }

  } else {
    // âŒ YanlÄ±ÅŸ
    span.className = 'word wrong';
    yanlisSayisi++;

    setTimeout(function() {
      if (currentWordIndex < targetWords.length && wordSpans[currentWordIndex]) {
        wordSpans[currentWordIndex].className = 'word active';
      }
    }, 420);

    if (yanlisSayisi >= 3) {
      btnGec.disabled = true;
      var hedefMetin = SEVIYELER[currentSeviye].kelimeler[currentKelimeIndex];
      gosterGeri('DoÄŸrusu: ' + hedefMetin, 'yanlis');
      // âŒ YALNIZCA yanlÄ±ÅŸta TTS Ã§alÄ±ÅŸÄ±r
      SpeechController.speak('DoÄŸrusu ÅŸuydu: ' + hedefMetin, { rate: 0.78, pitch: 1.05 });
      setTimeout(sonrakiKelimeyeGec, 2200);
    } else if (yanlisSayisi === 2) {
      gosterGeri('Tekrar dene! ğŸ’ª', 'yanlis');
    }
  }
}

// â”€â”€â”€ Oyunu sÄ±fÄ±rla â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function oyunuSifirla() {
  currentSeviye       = 0;
  currentKelimeIndex  = 0;
  currentWordIndex    = 0;
  score               = 0;
  yanlisSayisi        = 0;
  ustUsteDogruSayisi  = 0;
  scoreDisplay.textContent = '0';
  interimText.textContent  = '';
  feedbackBubble.className = 'feedback-bubble';
  congratsBanner.classList.remove('visible');
  errorMsg.classList.remove('visible');
  levelOverlay.classList.remove('visible');
  if (feedbackTimer) { clearTimeout(feedbackTimer); feedbackTimer = null; }
}

// â”€â”€â”€ Buton iÅŸleyicileri â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnStart.addEventListener('click', function() {
  if (!SR) return;
  if (SpeechController.isListening()) return;

  // Safari/iOS iÃ§in ses baÄŸlamÄ±nÄ± kullanÄ±cÄ± etkileÅŸimiyle baÅŸlat
  if (window.speechSynthesis) {
    var dummy = new SpeechSynthesisUtterance('');
    dummy.volume = 0;
    window.speechSynthesis.speak(dummy);
  }

  btnStart.disabled = true;
  btnStop.disabled  = false;
  oyunBasladi       = true;

  SpeechController.stopAll();
  oyunuSifirla();
  kelimeyiYukle();
  // kelimeyiYukle â†’ SpeechController.speak â†’ onend â†’ startListening otomatik
});

btnStop.addEventListener('click', function() {
  oyunBasladi = false;
  SpeechController.stopAll();
  btnStart.disabled = false;
  btnStop.disabled  = true;
  btnGec.disabled   = true;
  micStatus.textContent = 'BaÅŸlamak iÃ§in dÃ¼ÄŸmeye bas';
  wordCard.innerHTML = '<div class="word-placeholder">â–¶ BaÅŸla dÃ¼ÄŸmesine bas</div>';
  seviyeDisplay.textContent = 'â€”';
  kelimeDisplay.textContent = 'â€”';
});

btnGec.addEventListener('click', function() {
  if (btnGec.disabled || !oyunBasladi) return;
  gecKelime();
});

btnNextLevel.addEventListener('click', function() {
  sonrakiSeviyeyeGec();
});
</script>
</body>
</html>
